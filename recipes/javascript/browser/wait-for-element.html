<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">



    <meta property="og:site_name" content="Code Cookbook" />

    <title>Wait for element | Code Cookbook</title>

    <meta property="og:title" content="Wait for element" />

    <meta name="twitter:card" content="summary" />
    <meta property="twitter:title" content="Wait for element" />
<meta name="generator" content="Jekyll v4.3.1" />

<meta property="og:locale" content="en_US" />


    <meta name="description" content="Reusable code patterns which you can use as reference or copy to your project" />
    <meta property="og:description" content="Reusable code patterns which you can use as reference or copy to your project" />
<meta name="author" content="Michael Currin" />



<link rel="canonical" href="https://michaelcurrin.github.io/code-cookbook/recipes/javascript/browser/wait-for-element.html" />
<meta property="og:url" content="https://michaelcurrin.github.io/code-cookbook/recipes/javascript/browser/wait-for-element.html" />


<script type="application/ld+json">
{
    "name":        "Code Cookbook",
    "description": "Reusable code patterns which you can use as reference or copy to your project",
    "url":         "https://michaelcurrin.github.io/code-cookbook/recipes/javascript/browser/wait-for-element.html",
    "headline":    "Wait for element",
    "@type":       "WebSite",
    "@context":    "https://schema.org",
    "author": {
        "@type":"Person",
        "name": "Michael Currin"
    }
}
</script>
<link rel="stylesheet" href="/code-cookbook/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://michaelcurrin.github.io/code-cookbook/feed.xml" title="Code Cookbook" /><script async src="https://www.googletagmanager.com/gtag/js?id=G-ED9PSVN5DS"></script>
    <script>
        window['ga-disable-G-ED9PSVN5DS'] = window.doNotTrack === "1" || navigator.doNotTrack === "1" || navigator.doNotTrack === "yes" || navigator.msDoNotTrack === "1";
        window.dataLayer = window.dataLayer || [];

        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-ED9PSVN5DS');
    </script></head>
<body>
<header class="site-header" role="banner">

    <div class="wrapper"><a class="site-title" rel="author" href="/code-cookbook/">
            Code Cookbook
        </a><nav class="site-nav">
                <input type="checkbox" id="nav-trigger" class="nav-trigger" />

                <label for="nav-trigger">
                    <span class="menu-icon">
                        <svg viewBox="0 0 18 15" width="18px" height="15px">
                            <path
                                d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z" />
                        </svg>
                    </span>
                </label>

                <div class="trigger"><a class="page-link" href="/code-cookbook/">
                                Home
                            </a><a class="page-link" href="/code-cookbook/recipes/">
                                Recipes
                            </a><a class="page-link" href="/code-cookbook/about.html">
                                About
                            </a></div>
            </nav></div>
</header>
<main class="page-content" aria-label="Content">
        <div class="wrapper">
            <a id="github-edit" href="https://github.com/MichaelCurrin/code-cookbook/edit/master/recipes/javascript/browser/wait-for-element.md">
    üìù <span>Edit page</span>
</a>

            <a id="github-add" href="https://github.com/MichaelCurrin/code-cookbook/new/master/recipes/javascript/browser/">
    ‚ûï <span>Add page</span>
</a>


            

<article class="post">
    <header class="post-header">
        <h1 class="post-title">
            


            <span>Wait for element</span>
        </h1>

        
    </header>

    


    <div id="breadcrumbs">

    
        

        
            
            <a href="/code-cookbook/recipes/">
    Recipes
</a>

        
     
        
            /
        

        
            
            <a href="/code-cookbook/recipes/javascript/">
    JavaScript
</a>

        
     
        
            /
        

        
            
            <a href="/code-cookbook/recipes/javascript/browser/">
    Browser
</a>

        
     
        
            /
        

        
            <a href="/code-cookbook/recipes/javascript/browser/wait-for-element.html" class="underline">
                Wait for element
            </a>
        
     
    </div>



    <br>

    <div class="post-content">
        
            <p>There are a few ways to do this.</p>

<p>See <a href="https://stackoverflow.com/questions/15875128/is-there-element-rendered-event">question</a> on StackOverflow.</p>

<p>The examples here wait for a node to be rendered and then do something do it like append an element to it.</p>

<h2 id="using-animation-frame">Using animation frame</h2>

<p>Listen for repaints triggers, when the visible portion of the screen changes. This could be because of the elements added or update as nodes, or CSS changes like visiblity changes or color.</p>

<ul>
  <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame">requestAnimationFrame</a></li>
</ul>

<p>Using a recursive function. It runs initially and then afterwards it calls <code class="language-plaintext highlighter-rouge">requestAnimationFrame</code> repeatedly, checking if element is ready otherwise waiting again.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">onElementReady</span><span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span><span class="nx">resolve</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">waitForElement</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">resolve</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">waitForElement</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>
    
    <span class="nx">waitForElement</span><span class="p">();</span>
  <span class="p">})</span>
<span class="p">)</span>
</code></pre></div></div>

<p>As recommended in <a href="http://swizec.com/blog/how-to-properly-wait-for-dom-elements-to-show-up-in-modern-browsers/swizec/6663">post</a>.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">wait</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#element</span><span class="dl">"</span><span class="p">).</span><span class="nx">size</span><span class="p">())</span> <span class="p">{</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">wait</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#element</span><span class="dl">"</span><span class="p">).</span><span class="nx">doStuff</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<blockquote>
  <p>in practice it only ever retries once. Because no matter what, by the next render frame, whether it comes in a 60th of a second, or a minute, the element will have been rendered.</p>
</blockquote>

<h2 id="mutationobserver-approach">MutationObserver approach</h2>

<p>Listen for changes in the DOM, such as element added.</p>

<ul>
  <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver">MutationObserver</a></li>
</ul>

<p>From 2018, this is built-in for the browser. Not available in Node.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Options for the observer (which mutations to observe)</span>
<span class="kd">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span> 
  <span class="na">attributes</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> 
  <span class="na">childList</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> 
  <span class="na">subtree</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">callback</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">mutationsList</span><span class="p">,</span> <span class="nx">observer</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">mutation</span> <span class="k">of</span> <span class="nx">mutationsList</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">mutation</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">childList</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">A child node has been added or removed.</span><span class="dl">'</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mutation</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">attributes</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">The </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">mutation</span><span class="p">.</span><span class="nx">attributeName</span> <span class="o">+</span> <span class="dl">'</span><span class="s1"> attribute was modified.</span><span class="dl">'</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">observer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MutationObserver</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">targetNode</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">some-id</span><span class="dl">'</span><span class="p">);</span>
<span class="c1">// Start observing the target node for configured mutations.</span>
<span class="nx">observer</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="nx">targetNode</span><span class="p">,</span> <span class="nx">config</span><span class="p">);</span>

<span class="c1">// Later, you can stop observing</span>
<span class="nx">observer</span><span class="p">.</span><span class="nx">disconnect</span><span class="p">();</span>
</code></pre></div></div>

<p>Or this. Wait for body to be ready and then add an elemen to it.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span><span class="na">attributes</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">childList</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">characterData</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">subtree</span><span class="p">:</span><span class="kc">true</span><span class="p">}</span>

<span class="kd">function</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">mutations</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">myElement</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">It's in the DOM!</span><span class="dl">"</span><span class="p">);</span>
        <span class="nx">observer</span><span class="p">.</span><span class="nx">disconnect</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Or define and us inline.</span>
<span class="kd">const</span> <span class="nx">observer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MutationObserver</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">myElement</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">&lt;div&gt;hello world&lt;/div&gt;</span><span class="dl">"</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>

<span class="nx">observer</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="nx">config</span><span class="p">);</span>

<span class="nx">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">body</span><span class="dl">"</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">myElement</span><span class="p">);</span>
</code></pre></div></div>

<h2 id="resizeobserver">ResizeObserver</h2>

<p>In one case, solutions like setTimeout or MutationObserver weren‚Äôt totally realiable.</p>

<ul>
  <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/ResizeObserver">ResizeObserver</a>
    <blockquote>
      <p>Implementations should, if they follow the specification, invoke resize events before paint and after layout.</p>
    </blockquote>
  </li>
</ul>

<p>Te observer always fires after layout, thus we should be able to get the correct dimensions of the observed element.</p>

<p>As a bonus the observer already returns the dimensions of the element. Therefore we don‚Äôt even need to call something like <code class="language-plaintext highlighter-rouge">offsetWidth</code> (even though it should work too).</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">resizeObserver</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ResizeObserver</span><span class="p">(</span><span class="nx">entries</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">lastEntry</span> <span class="o">=</span> <span class="nx">entries</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>

  <span class="c1">// alternatively use contentBoxSize here</span>
  <span class="kd">const</span> <span class="nx">width</span> <span class="o">=</span> <span class="nx">lastEntry</span><span class="p">.</span><span class="nx">borderBoxSize</span><span class="p">.</span><span class="nx">inlineSize</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">height</span> <span class="o">=</span> <span class="nx">lastEntry</span><span class="p">.</span><span class="nx">borderBoxSize</span><span class="p">.</span><span class="nx">blockSize</span><span class="p">;</span>

  <span class="nx">resizeObserver</span><span class="p">.</span><span class="nx">disconnect</span><span class="p">();</span>

  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">width:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="dl">"</span><span class="s2">height:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">height</span><span class="p">);</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">myElement</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">div</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">myElement</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">test string</span><span class="dl">"</span><span class="p">;</span>

<span class="nx">resizeObserver</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="nx">myElement</span><span class="p">);</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">myElement</span><span class="p">);</span>
</code></pre></div></div>

        
    </div>
</article>

        </div>
    </main>
<footer class="site-footer h-card">
    <data class="u-url" href="/code-cookbook/"></data>

    <div class="wrapper">

        <h2 class="footer-heading">Code Cookbook</h2>

        <div class="footer-col-wrapper">
            <div class="footer-col footer-col-1">
                <ul class="contact-list"><li class="p-name">
                            Michael Currin
                        </li></ul>
            </div>

            <div class="footer-col footer-col-2">
<ul class="social-media-list"><li>
            <a href="https://github.com/MichaelCurrin"><svg class="svg-icon">
                    <use xlink:href="/code-cookbook/assets/fractal-social-icons.svg#github"></use>
                </svg> <span class="username">MichaelCurrin</span></a>
        </li></ul>
</div>

            <div class="footer-col footer-col-3">
                <p>Reusable code patterns which you can use as reference or copy to your project</p>
            </div>
        </div>

    </div>

</footer>
<a href="https://github.com/MichaelCurrin/code-cookbook"
    class="github-corner" aria-label="View source on GitHub">
    <svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
    </svg>
</a>
<style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

</body>

</html>
