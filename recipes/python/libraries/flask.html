<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">



    <meta property="og:site_name" content="Code Cookbook" />

    <title>Flask | Code Cookbook</title>

    <meta property="og:title" content="Flask" />

    <meta name="twitter:card" content="summary" />
    <meta property="twitter:title" content="Flask" />
<meta name="generator" content="Jekyll v4.3.1" />

<meta property="og:locale" content="en_US" />


    <meta name="description" content="Reusable code patterns which you can use as reference or copy to your project" />
    <meta property="og:description" content="Reusable code patterns which you can use as reference or copy to your project" />
<meta name="author" content="Michael Currin" />



<link rel="canonical" href="https://michaelcurrin.github.io/code-cookbook/recipes/python/libraries/flask.html" />
<meta property="og:url" content="https://michaelcurrin.github.io/code-cookbook/recipes/python/libraries/flask.html" />


<script type="application/ld+json">
{
    "name":        "Code Cookbook",
    "description": "Reusable code patterns which you can use as reference or copy to your project",
    "url":         "https://michaelcurrin.github.io/code-cookbook/recipes/python/libraries/flask.html",
    "headline":    "Flask",
    "@type":       "WebSite",
    "@context":    "https://schema.org",
    "author": {
        "@type":"Person",
        "name": "Michael Currin"
    }
}
</script>
<link rel="stylesheet" href="/code-cookbook/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://michaelcurrin.github.io/code-cookbook/feed.xml" title="Code Cookbook" /><script async src="https://www.googletagmanager.com/gtag/js?id=G-ED9PSVN5DS"></script>
    <script>
        window['ga-disable-G-ED9PSVN5DS'] = window.doNotTrack === "1" || navigator.doNotTrack === "1" || navigator.doNotTrack === "yes" || navigator.msDoNotTrack === "1";
        window.dataLayer = window.dataLayer || [];

        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-ED9PSVN5DS');
    </script></head>
<body>
<header class="site-header" role="banner">

    <div class="wrapper"><a class="site-title" rel="author" href="/code-cookbook/">
            Code Cookbook
        </a><nav class="site-nav">
                <input type="checkbox" id="nav-trigger" class="nav-trigger" />

                <label for="nav-trigger">
                    <span class="menu-icon">
                        <svg viewBox="0 0 18 15" width="18px" height="15px">
                            <path
                                d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z" />
                        </svg>
                    </span>
                </label>

                <div class="trigger"><a class="page-link" href="/code-cookbook/">
                                Home
                            </a><a class="page-link" href="/code-cookbook/recipes/">
                                Recipes
                            </a><a class="page-link" href="/code-cookbook/about.html">
                                About
                            </a></div>
            </nav></div>
</header>
<main class="page-content" aria-label="Content">
        <div class="wrapper">
            <a id="github-edit" href="https://github.com/MichaelCurrin/code-cookbook/edit/master/recipes/python/libraries/flask.md">
    üìù <span>Edit page</span>
</a>

            <a id="github-add" href="https://github.com/MichaelCurrin/code-cookbook/new/master/recipes/python/libraries/">
    ‚ûï <span>Add page</span>
</a>


            

<article class="post">
    <header class="post-header">
        <h1 class="post-title">
            


            <span>Flask</span>
        </h1>

        
    </header>

    


    <div id="breadcrumbs">

    
        

        
            
            <a href="/code-cookbook/recipes/">
    Recipes
</a>

        
     
        
            /
        

        
            
            <a href="/code-cookbook/recipes/python/">
    Python
</a>

        
     
        
            /
        

        
            
            <a href="">
    
</a>

        
     
        
            /
        

        
            <a href="/code-cookbook/recipes/python/libraries/flask.html" class="underline">
                Flask
            </a>
        
     
    </div>



    <br>

    <div class="post-content">
        
            <p>This section assumes familiarity with the <a href="https://flask.palletsprojects.com/en/1.1.x/">Flask</a> library.</p>

<h2 id="make-a-csv-downloadable">Make a CSV downloadable</h2>

<p>Set up your application.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">make_response</span>


<span class="k">def</span> <span class="nf">to_csv</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="s">"""
    Convert data to downloadable CSV file.
    """</span>
    <span class="n">str_buffer</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
    <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="p">.</span><span class="n">writer</span><span class="p">(</span><span class="n">str_buffer</span><span class="p">)</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">writerows</span><span class="p">([</span><span class="n">fields</span><span class="p">])</span>
    <span class="n">writer</span><span class="p">.</span><span class="n">writerows</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="n">str_buffer</span><span class="p">.</span><span class="n">getvalue</span><span class="p">())</span>
    <span class="n">output</span><span class="p">.</span><span class="n">headers</span><span class="p">[</span><span class="s">"Content-Disposition"</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"attachment; filename=</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s">"</span>
    <span class="n">output</span><span class="p">.</span><span class="n">headers</span><span class="p">[</span><span class="s">"Content-type"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"text/csv"</span>

    <span class="k">return</span> <span class="n">output</span>


<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/export.csv"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">request_csv</span><span class="p">():</span>
    <span class="s">"""
    Endpoint to allow a user to download a CSV.
    """</span>
    <span class="n">rows</span><span class="p">,</span> <span class="n">fields</span> <span class="o">=</span> <span class="n">lib</span><span class="p">.</span><span class="n">fetch_data</span><span class="p">(</span><span class="n">SQL_SOURCE</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">to_csv</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="s">'export.csv'</span><span class="p">)</span>
</code></pre></div></div>

<p>Start the server.</p>

<p>Visit the endpoint or add a button which points to it. You will get prompted to download a file.</p>

<ul>
  <li>http://localhost:5000/export.csv</li>
</ul>

<h2 id="caching">Caching</h2>

<p>Add caching to your Flask application to reduce load on your server.</p>

<p>For example, if your server does any heavy computing, reading from a database or external API calls, you can improve performance (and therefore reduce request time) by using cache.</p>

<ul>
  <li><a href="https://flask-caching.readthedocs.io/en/latest/">Flask-Caching</a> docs.</li>
</ul>

<p>Install in your virtual environment.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pip <span class="nb">install </span>Flask-Caching
</code></pre></div></div>

<p>Some config options:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">CACHE_TYPE</code> Specifies which <strong>type</strong> of caching object to use. See the docs for all the choices such as Reddis. Here we use the <code class="language-plaintext highlighter-rouge">simple</code> in-memory Python cache which exists only inside the main Python process and is not thread safe and therefore not suitable for production environments.</li>
  <li><code class="language-plaintext highlighter-rouge">CACHE_DEFAULT_TIMEOUT</code>. The default <strong>timeout</strong> (expiry time) that is used if no timeout is specified. Unit of time is <strong>seconds</strong>. You can set timeout on individual functions to override this.</li>
  <li><code class="language-plaintext highlighter-rouge">CACHE_THRESHOLD</code> - The <strong>maximum number of items</strong> the cache will store before it starts deleting some. Used only for SimpleCache and FileSystemCache.</li>
</ul>

<p>Set up your application.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">datetime</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<span class="kn">from</span> <span class="nn">flask_caching</span> <span class="kn">import</span> <span class="n">Cache</span>


<span class="n">CACHE_OPTIONS</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">CACHE_TYPE</span><span class="o">=</span><span class="s">"simple"</span><span class="p">,</span>
    <span class="n">CACHE_DEFAULT_TIMEOUT</span><span class="o">=</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span>
<span class="p">)</span>


<span class="n">cache</span> <span class="o">=</span> <span class="n">Cache</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">CACHE_OPTIONS</span><span class="p">)</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">cache</span><span class="p">.</span><span class="n">init_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>


<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/cache-test"</span><span class="p">)</span>
<span class="o">@</span><span class="n">cache</span><span class="p">.</span><span class="n">cached</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">())</span>


<span class="k">if</span>  <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">app</span><span class="p">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div></div>

<p>Regarding use of the decorator:</p>

<ul>
  <li>The syntax is <code class="language-plaintext highlighter-rouge">@cache.cached()</code>.
    <ul>
      <li>The brackets are required or you will get an error.</li>
      <li>Optionally specify a timeout in seconds. e.g. <code class="language-plaintext highlighter-rouge">@cache.cached(timeout=50)</code></li>
    </ul>
  </li>
  <li>Apply the decorator on a view (to cache the HTML or JSON API response) or on any non-view function.</li>
  <li>Based on the docs, note that the decorator must be used between the route decorator and the function name, so that the function is cache and not the result of the route..</li>
</ul>

<p>Start the application.</p>

<p>Open the browser:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">http://localhost:5000/cache-test</code></li>
</ul>

<p>You‚Äôll see the current time. Because of <code class="language-plaintext highlighter-rouge">@cache.cached</code> line, the result will be cached on page refreshes. Comment out the line and restart - then you‚Äôll caching is disabled and you will get a new value on each page refresh.</p>

        
    </div>
</article>

        </div>
    </main>
<footer class="site-footer h-card">
    <data class="u-url" href="/code-cookbook/"></data>

    <div class="wrapper">

        <h2 class="footer-heading">Code Cookbook</h2>

        <div class="footer-col-wrapper">
            <div class="footer-col footer-col-1">
                <ul class="contact-list"><li class="p-name">
                            Michael Currin
                        </li></ul>
            </div>

            <div class="footer-col footer-col-2">
<ul class="social-media-list"><li>
            <a href="https://github.com/MichaelCurrin"><svg class="svg-icon">
                    <use xlink:href="/code-cookbook/assets/fractal-social-icons.svg#github"></use>
                </svg> <span class="username">MichaelCurrin</span></a>
        </li></ul>
</div>

            <div class="footer-col footer-col-3">
                <p>Reusable code patterns which you can use as reference or copy to your project</p>
            </div>
        </div>

    </div>

</footer>
<a href="https://github.com/MichaelCurrin/code-cookbook"
    class="github-corner" aria-label="View source on GitHub">
    <svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
    </svg>
</a>
<style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

</body>

</html>
