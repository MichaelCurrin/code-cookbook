<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">



    <meta property="og:site_name" content="Code Cookbook" />

    <title>Upgrade packages | Code Cookbook</title>

    <meta property="og:title" content="Upgrade packages" />

    <meta name="twitter:card" content="summary" />
    <meta property="twitter:title" content="Upgrade packages" />
<meta name="generator" content="Jekyll v4.3.1" />

<meta property="og:locale" content="en_US" />


    <meta name="description" content="Upgrade outdated NPM packages and make a PR with the lockfile changes" />
    <meta property="og:description" content="Upgrade outdated NPM packages and make a PR with the lockfile changes" />
<meta name="author" content="Michael Currin" />



<link rel="canonical" href="https://michaelcurrin.github.io/code-cookbook/recipes/ci-cd/github-actions/workflows/node/upgrade-packages.html" />
<meta property="og:url" content="https://michaelcurrin.github.io/code-cookbook/recipes/ci-cd/github-actions/workflows/node/upgrade-packages.html" />


<script type="application/ld+json">
{
    "name":        "Code Cookbook",
    "description": "Upgrade outdated NPM packages and make a PR with the lockfile changes",
    "url":         "https://michaelcurrin.github.io/code-cookbook/recipes/ci-cd/github-actions/workflows/node/upgrade-packages.html",
    "headline":    "Upgrade packages",
    "@type":       "WebSite",
    "@context":    "https://schema.org",
    "author": {
        "@type":"Person",
        "name": "Michael Currin"
    }
}
</script>
<link rel="stylesheet" href="/code-cookbook/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://michaelcurrin.github.io/code-cookbook/feed.xml" title="Code Cookbook" /><script async src="https://www.googletagmanager.com/gtag/js?id=G-ED9PSVN5DS"></script>
    <script>
        window['ga-disable-G-ED9PSVN5DS'] = window.doNotTrack === "1" || navigator.doNotTrack === "1" || navigator.doNotTrack === "yes" || navigator.msDoNotTrack === "1";
        window.dataLayer = window.dataLayer || [];

        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-ED9PSVN5DS');
    </script></head>
<body>
<header class="site-header" role="banner">

    <div class="wrapper"><a class="site-title" rel="author" href="/code-cookbook/">
            Code Cookbook
        </a><nav class="site-nav">
                <input type="checkbox" id="nav-trigger" class="nav-trigger" />

                <label for="nav-trigger">
                    <span class="menu-icon">
                        <svg viewBox="0 0 18 15" width="18px" height="15px">
                            <path
                                d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z" />
                        </svg>
                    </span>
                </label>

                <div class="trigger"><a class="page-link" href="/code-cookbook/">
                                Home
                            </a><a class="page-link" href="/code-cookbook/recipes/">
                                Recipes
                            </a><a class="page-link" href="/code-cookbook/about.html">
                                About
                            </a></div>
            </nav></div>
</header>
<main class="page-content" aria-label="Content">
        <div class="wrapper">
            <a id="github-edit" href="https://github.com/MichaelCurrin/code-cookbook/edit/master/recipes/ci-cd/github-actions/workflows/node/upgrade-packages.md">
    üìù <span>Edit page</span>
</a>

            <a id="github-add" href="https://github.com/MichaelCurrin/code-cookbook/new/master/recipes/ci-cd/github-actions/workflows/node/">
    ‚ûï <span>Add page</span>
</a>


            

<article class="post">
    <header class="post-header">
        <h1 class="post-title">
            


            <span>Upgrade packages</span>
        </h1>

        
            <blockquote>
                <p>Upgrade outdated NPM packages and make a PR with the lockfile changes</p>

            </blockquote>
        
    </header>

    


    <div id="breadcrumbs">

    
        

        
            
            <a href="/code-cookbook/recipes/">
    Recipes
</a>

        
     
        
            /
        

        
            
            <a href="/code-cookbook/recipes/ci-cd/">
    CI/CD
</a>

        
     
        
            /
        

        
            
            <a href="/code-cookbook/recipes/ci-cd/github-actions/">
    GitHub Actions
</a>

        
     
        
            /
        

        
            
            <a href="/code-cookbook/recipes/ci-cd/github-actions/workflows/">
    Workflows
</a>

        
     
        
            /
        

        
            
            <a href="/code-cookbook/recipes/ci-cd/github-actions/workflows/node/">
    Node.js
</a>

        
     
        
            /
        

        
            <a href="/code-cookbook/recipes/ci-cd/github-actions/workflows/node/upgrade-packages.html" class="underline">
                Upgrade packages
            </a>
        
     
    </div>



    <br>

    <div class="post-content">
        
            <h2 id="about">About</h2>

<p>The workflow recipes on this page let you use GH Actions to upgrade your NPM dependencies automatically and safely, without touching the command-line.</p>

<p>Run the workflow a schedule or on a manual trigger and GH Actions will do the upgrade for you on a branch with a PR.</p>

<p>You‚Äôll get changes to your lock files (<code class="language-plaintext highlighter-rouge">package-lock.json</code> and <code class="language-plaintext highlighter-rouge">yarn.lock</code>) and also sometimes to <code class="language-plaintext highlighter-rouge">package.json</code> (when using <code class="language-plaintext highlighter-rouge">npm</code> but not when using <code class="language-plaintext highlighter-rouge">yarn</code>).</p>

<h2 id="why">Why?</h2>

<p>The advantage is to stay up to date within the semantic versioning restrictions in <code class="language-plaintext highlighter-rouge">package.json</code>, such that you get updated direct dependencies and indirect dependencies. Thus avoiding bugs and vulnerabilities.</p>

<p>While taking the manual effort out of running manual tasks (upgrading locally, committing and checking if checks pass).</p>

<p>Especially useful if you frequently have to use dependabot to patch very nested indirect dependencies and upgrading a higher-level dependency reduces this.</p>

<p>This also effectively patches eagerly to newer versions even <em>before</em> any vulnerabilities in old versions are discovered.</p>

<h2 id="related">Related</h2>

<ul>
  <li><a href="https://michaelcurrin.github.io/dev-cheatsheets/cheatsheets/package-managers/javascript/npm/upgrade-packages.html">Upgrade packages</a> cheatsheet for NPM.</li>
  <li><a href="https://dev.to/michaelcurrin/upgrade-npm-packages-with-gh-actions-55md">Upgrade NPM packages with GH Actions</a> - my blog post.</li>
</ul>

<h2 id="steps">Steps</h2>

<h3 id="what-the-workflows-does">What the workflows does</h3>

<ol>
  <li>Set up Node</li>
  <li>Check for outdated packages that are still within the semvar restrictions (so hopefully no breaking changes in your app).</li>
  <li>Upgrade packages.</li>
  <li>Commit to a branch and create a PR. See <a href="/code-cookbook/recipes/ci-cd/github-actions/workflows/create-pull-request.html">Create Pull Request</a> recipes.</li>
</ol>

<p>That should trigger a GH notification. Then you can review the PR changes yourself.</p>

<h3 id="what-you-need-to-do">What you need to do</h3>

<ol>
  <li>Pick one of the samples below, depending on basic/advanced and Node/Yarn.</li>
  <li>Run the workflow manually on GH or on a schedule (such as weekly).</li>
  <li>Get your CI checks to run on the PR.</li>
  <li>Chekck your standard CI checks are passing (such as to build and test the app).</li>
  <li>Decide what to do with the PR.
    <ul>
      <li>Merge and review the PR.</li>
      <li>Update the code your self with the same PR or a new PR. e.g. if two packages were upgraded and one causes an error, then downgrade that one.</li>
      <li>Or close the PR and just accept the old versions of packages.</li>
    </ul>
  </li>
</ol>

<p>Note on the last part around CI checks running:</p>

<ul>
  <li>Normally these checks would run on creation of the PR.</li>
  <li>For security reasons on GitHub‚Äôs side, the PR/branch created GH Actions <em>cannot</em> cause workflows to run. See <a href="https://github.com/peter-evans/create-pull-request/issues/48">issue</a>.</li>
  <li>Even if your Approve the workflow. There <em>is</em> an ‚ÄúApprove and Run‚Äù button that appears in PRs to trigger checks, but this only works across <em>forks</em>. There are</li>
  <li>The workarounds I have:
    <ul>
      <li>Just to make a non-functional commit, like adding a space to the package lockfile. When I commit that in GitHub, then the checks run.</li>
      <li>Alternatively you can close the PR and make a new one against the branch that the workflow made - this works but isn‚Äôt so clean.</li>
      <li>Or for a larger change, you can add the build and test steps to the upgrade packages workflow, so that it covers everything. It just becomes longer and more  project-specific.</li>
    </ul>
  </li>
</ul>

<h2 id="samples">Samples</h2>

<p>Note that Node is <em>already</em> in the environment, but you get more control using the <em>Set up Node</em> step here, like picking a Node version.</p>

<h3 id="basic">Basic</h3>

<p>Here using a minimal approach.</p>

<p>Two run options:</p>

<ul>
  <li>Manual - trigger from within Actions tab.</li>
  <li>On a schedule (weekly on a Sunday a midnight here).</li>
</ul>

<p>The PR step will do nothing if there is nothing to commit.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">upgrade-packages.yml</code>
    <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="na">name</span><span class="pi">:</span> <span class="s">Upgrade NPM packages</span>

  <span class="na">on</span><span class="pi">:</span>
    <span class="na">workflow_dispatch</span><span class="pi">:</span>

    <span class="na">schedule</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">cron</span><span class="pi">:</span>  <span class="s2">"</span><span class="s">0</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">0"</span>
        
  <span class="na">jobs</span><span class="pi">:</span>
    <span class="na">upgrade-packages</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">Upgrade packages</span>

      <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>

      <span class="na">steps</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Checkout üõéÔ∏è</span>
          <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2</span>

        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set up Node.js ‚öôÔ∏è</span>
          <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-node@v2</span>
          <span class="na">with</span><span class="pi">:</span>
            <span class="na">node-version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">16.x'</span>

        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Upgrade packages üîÄ</span>
          <span class="na">run</span><span class="pi">:</span> <span class="s">npm update</span>

        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Commit and create PR üîÄ</span>
          <span class="na">uses</span><span class="pi">:</span> <span class="s">peter-evans/create-pull-request@v3</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="use-yarn">Use Yarn</h3>

<p>Yarn will be set up already in the environment, so no need to add a step to install Yarn.</p>

<p>So just change <code class="language-plaintext highlighter-rouge">npm</code> commands to use <code class="language-plaintext highlighter-rouge">yarn</code>.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">upgrade-packages.yml</code>
    <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="na">steps</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Checkout üõéÔ∏è</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set up Node.js ‚öôÔ∏è</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-node@v2</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">node-version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">16.x'</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Check for outdated packages üîç</span>
      <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">OUTDATED_OUTPUT=$(yarn outdated) || true</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Upgrade packages üîÄ</span>
      <span class="na">run</span><span class="pi">:</span> <span class="s">yarn upgrade</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Commit and create PR</span> 
      <span class="na">uses</span><span class="pi">:</span> <span class="s">peter-evans/create-pull-request@v3</span>
</code></pre></div>    </div>
  </li>
</ul>

<p>See <a href="/code-cookbook/recipes/ci-cd/github-actions/workflows/node/yarn.html">Yarn</a> recipe for more help.</p>

<h3 id="advanced">Advanced</h3>

<p>In this one:</p>

<ul>
  <li>Use <em>cache</em> to improve performance.
    <ul>
      <li>Packages not yet installed will appear as <code class="language-plaintext highlighter-rouge">MISSING</code>. This is fine.</li>
      <li>If you have packages installed already and loaded from cache (whether from the old or new <code class="language-plaintext highlighter-rouge">package.json</code> file, then the <code class="language-plaintext highlighter-rouge">npm install</code> and <code class="language-plaintext highlighter-rouge">npm update</code> will have less to do (at least when there is cache against the lockfile).</li>
    </ul>
  </li>
  <li>We make sure the upgrade and PR steps are only attempts <em>if</em> there is something to upgrade.
    <ul>
      <li>We don‚Äôt care whether <code class="language-plaintext highlighter-rouge">npm outdated</code> exits with success (nothing to update) or error status (something to update), but rather force a success and then check if the output is empty or not.</li>
    </ul>
  </li>
  <li>We set custom parameters on the PR step.</li>
</ul>

<p>Here is a sample (using Yarn) - <a href="https://github.com/MichaelCurrin/badge-generator/pull/129">PR #129</a>.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">upgrade-packages.yml</code>
    <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="na">name</span><span class="pi">:</span> <span class="s">Upgrade NPM packages</span>

  <span class="na">on</span><span class="pi">:</span>
    <span class="na">workflow_dispatch</span><span class="pi">:</span>

    <span class="na">schedule</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">cron</span><span class="pi">:</span>  <span class="s2">"</span><span class="s">0</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">0"</span>

  <span class="na">jobs</span><span class="pi">:</span>
    <span class="na">upgrade-packages</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">Upgrade packages</span>

      <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>

      <span class="na">steps</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Checkout üõéÔ∏è</span>
          <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2</span>

        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set up Node.js ‚öôÔ∏è</span>
          <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-node@v2</span>
          <span class="na">with</span><span class="pi">:</span>
            <span class="na">node-version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">16.x'</span>
            <span class="na">cache</span><span class="pi">:</span> <span class="s1">'</span><span class="s">npm'</span>

        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Check for outdated packages üîç</span>
          <span class="na">id</span><span class="pi">:</span> <span class="s">vars</span>
          <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
            <span class="s">OUTDATED=$(npm outdated) || true</span>

            <span class="s">if [[ -z "$OUTDATED" ]]; then</span>
              <span class="s">echo 'Nothing to upgrade'</span>
            <span class="s">else</span>
              <span class="s">echo 'Found outdated packages:'</span>
              <span class="s">echo "$OUTDATED"</span>
            <span class="s">fi</span>

            <span class="s">echo "::set-output name=outdated::$OUTDATED"</span>

        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Upgrade packages ‚è´</span>
          <span class="na">if</span><span class="pi">:</span> <span class="s">${{ steps.outdated.outputs.outdated != '' }}</span>
          <span class="na">run</span><span class="pi">:</span> <span class="s">npm update</span>

        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Commit and create PR üîÄ</span>
          <span class="na">if</span><span class="pi">:</span> <span class="s">${{ steps.vars.outputs.outdated != '' }}</span>
          <span class="na">uses</span><span class="pi">:</span> <span class="s">peter-evans/create-pull-request@v3</span>
          <span class="na">with</span><span class="pi">:</span>
            <span class="na">title</span><span class="pi">:</span> <span class="s1">'</span><span class="s">build(deps):</span><span class="nv"> </span><span class="s">Upgrade</span><span class="nv"> </span><span class="s">NPM</span><span class="nv"> </span><span class="s">packages</span><span class="nv"> </span><span class="s">(automated)'</span>
            <span class="na">branch</span><span class="pi">:</span> <span class="s1">'</span><span class="s">build-deps-upgrade-npm-packages-automated'</span>
            <span class="na">commit-message</span><span class="pi">:</span> <span class="s1">'</span><span class="s">build(deps):</span><span class="nv"> </span><span class="s">upgrade</span><span class="nv"> </span><span class="s">NPM</span><span class="nv"> </span><span class="s">packages</span><span class="nv"> </span><span class="s">(automated)'</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="aggressive-upgrade">Aggressive upgrade</h3>

<p>Using <code class="language-plaintext highlighter-rouge">npm update</code> will only upgrade <em>within</em> the semver version.</p>

<p>e.g. <code class="language-plaintext highlighter-rouge">^1.2.3</code> will allow <code class="language-plaintext highlighter-rouge">1.*.*</code> values after <code class="language-plaintext highlighter-rouge">1.2.3</code> but never major version changes like <code class="language-plaintext highlighter-rouge">2.*.*</code> or higher.</p>

<p>If you want to upgrade outside the restriction, at the risk of getting breaking changes (which are possibly <strong>incompatible</strong> with your codebase), you can use this approach.</p>

<p>Note we use <a href="https://michaelcurrin.github.io/dev-resources/resources/javascript/packages/package-versions/ncu.html">npm-check-updates</a> which does <em>not</em> actually install packages.</p>

<p><em>Warning: untested.</em></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">update-packages.yml</code>
    <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="na">steps</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install NCU üîß</span>
      <span class="na">run</span><span class="pi">:</span> <span class="s">npm install -g npm-check-packages</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Check for outdated packages üîç</span>
      <span class="na">id</span><span class="pi">:</span> <span class="s">vars</span>
      <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">if ncu -e 2; then</span>
          <span class="s">IS_OUTDATED=true</span>
          <span class="s">echo 'Nothing to upgrade'</span>
        <span class="s">else</span>
          <span class="s">IS_OUTDATED=false</span>
          <span class="s">echo 'Found outdated packages:'</span>
        <span class="s">fi</span>

        <span class="s">echo "::set-output name=is_outdated::$IS_OUTDATED"</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Upgrade packages ‚è´</span>
      <span class="na">if</span><span class="pi">:</span> <span class="s">${{ steps.vars.outputs.is_outdated == 'true' }}</span>
      <span class="na">run</span><span class="pi">:</span> <span class="s">ncu -u</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Commit and create PR üîÄ</span>
      <span class="na">if</span><span class="pi">:</span> <span class="s">${{ steps.vars.outputs.is_outdated == 'true' }}</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">peter-evans/create-pull-request@v3</span>
</code></pre></div>    </div>
  </li>
</ul>

<p>Or simplify like this. The PR step will do nothing if there are no changes.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">update-packages.yml</code>
    <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="na">steps</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install NCU üîß</span>
      <span class="na">run</span><span class="pi">:</span> <span class="s">npm install -g npm-check-packages</span>
        
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Upgrade packages ‚è´</span>
      <span class="na">run</span><span class="pi">:</span> <span class="s">ncu -u</span>
        
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Commit and create PR üîÄ</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">peter-evans/create-pull-request@v3</span>
</code></pre></div>    </div>
  </li>
</ul>

<p>See <a href="https://michaelcurrin.github.io/dev-resources/resources/javascript/packages/package-versions/">Package versions</a> cheatsheet for more info on tools for upgrading.</p>

<h2 id="run-checks-within-upgrade-workflow">Run checks within upgrade workflow</h2>

<p>Build on the basic workflow, but with checks running in the workflow.</p>

<p>Note that it running any linting and formatting steps is still useful here, because your workflow might actually upgrade ESLint or Prettier, even if your codebase stays unchanged.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">upgrade-packages.yml</code>
    <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="na">jobs</span><span class="pi">:</span>
    <span class="na">upgrade-packages</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">Upgrade packages</span>

      <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>

      <span class="na">steps</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Checkout üõéÔ∏è</span>
          <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2</span>

        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set up Node.js ‚öôÔ∏è</span>
          <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-node@v2</span>
          <span class="na">with</span><span class="pi">:</span>
            <span class="na">node-version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">16.x'</span>

        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Check for outdated packages üîç</span>
          <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
            <span class="s">OUTDATED_OUTPUT=$(npm outdated) || true</span>

        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Upgrade packages ‚è´</span>
          <span class="na">run</span><span class="pi">:</span> <span class="s">npm update</span>
       
       <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Lint üßê</span>
         <span class="na">run</span><span class="pi">:</span> <span class="s">npm run lint:check</span>
            
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Test üö®</span>
          <span class="na">run</span><span class="pi">:</span> <span class="s">npm test</span>
          
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build üèóÔ∏è</span>
          <span class="na">run</span><span class="pi">:</span> <span class="s">npm run build</span>

        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Commit and create PR</span>
          <span class="na">uses</span><span class="pi">:</span> <span class="s">peter-evans/create-pull-request@v3</span>
</code></pre></div>    </div>
  </li>
</ul>

<p>Note that update step will also <em>install</em> packages, so you can omit <code class="language-plaintext highlighter-rouge">npm install</code> as a step.</p>

<h2 id="notes">Notes</h2>

<h3 id="verify-result-with-ci">Verify result with CI</h3>

<p>This flow only upgrades the packages and puts it in your a branch and PR - then you use your own CI to verify.</p>

<p>ideally you have GH Actions or similar set up to run CI checks against your PR. This lets you keep your current process of quality control and keeps the automatic upgrade flow from doing too too much.</p>

<p>e.g.</p>

<ol>
  <li>lint</li>
  <li>test</li>
  <li>compile TypeScript</li>
  <li>build app</li>
</ol>

<h3 id="lockfile">Lockfile</h3>

<p>The flow is intended for if you already have a lockfile, so that it can updated. In the section below, a <code class="language-plaintext highlighter-rouge">package-lock.json</code> file will be created if one does not exist.</p>

<p>NPM CLI will update the lockfile. But the <code class="language-plaintext highlighter-rouge">package.json</code> won‚Äôt be affected.</p>

<p>But Yarn will <em>also</em> update the version in <code class="language-plaintext highlighter-rouge">package.json</code>.</p>

        
    </div>
</article>

        </div>
    </main>
<footer class="site-footer h-card">
    <data class="u-url" href="/code-cookbook/"></data>

    <div class="wrapper">

        <h2 class="footer-heading">Code Cookbook</h2>

        <div class="footer-col-wrapper">
            <div class="footer-col footer-col-1">
                <ul class="contact-list"><li class="p-name">
                            Michael Currin
                        </li></ul>
            </div>

            <div class="footer-col footer-col-2">
<ul class="social-media-list"><li>
            <a href="https://github.com/MichaelCurrin"><svg class="svg-icon">
                    <use xlink:href="/code-cookbook/assets/fractal-social-icons.svg#github"></use>
                </svg> <span class="username">MichaelCurrin</span></a>
        </li></ul>
</div>

            <div class="footer-col footer-col-3">
                <p>Reusable code patterns which you can use as reference or copy to your project</p>
            </div>
        </div>

    </div>

</footer>
<a href="https://github.com/MichaelCurrin/code-cookbook"
    class="github-corner" aria-label="View source on GitHub">
    <svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
    </svg>
</a>
<style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

</body>

</html>
