<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">



    <meta property="og:site_name" content="Code Cookbook" />

    <title>Format | Code Cookbook</title>

    <meta property="og:title" content="Format" />

    <meta name="twitter:card" content="summary" />
    <meta property="twitter:title" content="Format" />
<meta name="generator" content="Jekyll v4.4.1" />

<meta property="og:locale" content="en_US" />


    <meta name="description" content="Reusable code patterns which you can use as reference or copy to your project" />
    <meta property="og:description" content="Reusable code patterns which you can use as reference or copy to your project" />
<meta name="author" content="Michael Currin" />



<link rel="canonical" href="https://michaelcurrin.github.io/code-cookbook/recipes/ci-cd/github-actions/workflows/python/format.html" />
<meta property="og:url" content="https://michaelcurrin.github.io/code-cookbook/recipes/ci-cd/github-actions/workflows/python/format.html" />


<script type="application/ld+json">
{
    "name":        "Code Cookbook",
    "description": "Reusable code patterns which you can use as reference or copy to your project",
    "url":         "https://michaelcurrin.github.io/code-cookbook/recipes/ci-cd/github-actions/workflows/python/format.html",
    "headline":    "Format",
    "@type":       "WebSite",
    "@context":    "https://schema.org",
    "author": {
        "@type":"Person",
        "name": "Michael Currin"
    }
}
</script>
<link rel="stylesheet" href="/code-cookbook/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://michaelcurrin.github.io/code-cookbook/feed.xml" title="Code Cookbook" /><script async src="https://www.googletagmanager.com/gtag/js?id=G-ED9PSVN5DS"></script>
    <script>
        window['ga-disable-G-ED9PSVN5DS'] = window.doNotTrack === "1" || navigator.doNotTrack === "1" || navigator.doNotTrack === "yes" || navigator.msDoNotTrack === "1";
        window.dataLayer = window.dataLayer || [];

        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-ED9PSVN5DS');
    </script></head>
<body>
<header class="site-header" role="banner">

    <div class="wrapper"><a class="site-title" rel="author" href="/code-cookbook/">
            Code Cookbook
        </a><nav class="site-nav">
            <input type="checkbox" id="nav-trigger" class="nav-trigger" />

            <label for="nav-trigger">
                <span class="menu-icon">
                    <svg viewBox="0 0 18 15" width="18px" height="15px">
                        <path
                            d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z" />
                    </svg>
                </span>
            </label>

            <div class="trigger"><a class="page-link" href="/code-cookbook/">
                    Home
                </a><a class="page-link" href="/code-cookbook/recipes/">
                    Recipes
                </a><a class="page-link" href="/code-cookbook/about.html">
                    About
                </a><a class="ext-link page-link" href="https://michaelcurrin.github.io/dev-cheatsheets/">
                    <span>Dev Cheatsheets</span>
                    <img src="/code-cookbook/assets/ext-link.svg" />
                </a><a class="ext-link page-link" href="https://michaelcurrin.github.io/dev-resources/">
                    <span>Dev Resources</span>
                    <img src="/code-cookbook/assets/ext-link.svg" />
                </a></div>
        </nav></div>
</header>
<main class="page-content" aria-label="Content">
        <div class="wrapper">
            <a id="github-edit" href="https://github.com/MichaelCurrin/code-cookbook/edit/master/recipes/ci-cd/github-actions/workflows/python/format.md">
    üìù <span>Edit page</span>
</a>

            <a id="github-add" href="https://github.com/MichaelCurrin/code-cookbook/new/master/recipes/ci-cd/github-actions/workflows/python/">
    ‚ûï <span>Add page</span>
</a>


            

<article class="post">
    <header class="post-header">
        <h1 class="post-title">
            


            <span>Format</span>
        </h1>

        
    </header>

    


    <div id="breadcrumbs">

    
        

        
            
            <a href="/code-cookbook/recipes/">
    Recipes
</a>

        
     
        
            /
        

        
            
            <a href="/code-cookbook/recipes/ci-cd/">
    CI/CD
</a>

        
     
        
            /
        

        
            
            <a href="/code-cookbook/recipes/ci-cd/github-actions/">
    GitHub Actions
</a>

        
     
        
            /
        

        
            
            <a href="/code-cookbook/recipes/ci-cd/github-actions/workflows/">
    Workflows
</a>

        
     
        
            /
        

        
            
            <a href="/code-cookbook/recipes/ci-cd/github-actions/workflows/python/">
    Python
</a>

        
     
        
            /
        

        
            <a href="/code-cookbook/recipes/ci-cd/github-actions/workflows/python/format.html" class="underline">
                Format
            </a>
        
     
    </div>



    <br>

    <div class="post-content">
        
            <p>This section uses a workflow to apply formatting with GitHub Actions and commit the results.</p>

<h2 id="notes">Notes</h2>

<p>Based on <a href="https://dev.to/mritunjay394/how-to-automate-code-formatting-for-python-projects-with-github-actions-a-study-47g8">post</a>.</p>

<p>It uses <code class="language-plaintext highlighter-rouge">yapf</code> - I prefer using <code class="language-plaintext highlighter-rouge">black</code> and <code class="language-plaintext highlighter-rouge">flake8</code>.</p>

<p>Also I prefer to apply formatting locally by hand or with a push hook and to check formatting and linting on a workflow run, without changing code in the cloud. And then the local code is more consistent with what is on the remote and also you don‚Äôt have to pull after every push.</p>

<p>But I include this flow anyway for interest of the pieces.</p>

<h2 id="sample">Sample</h2>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">name</span><span class="pi">:</span> <span class="s">Format Python code</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="na">pull_request</span><span class="pi">:</span>
    <span class="na">paths</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">**.py"</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">format</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>

    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Checkout</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@master</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">ref</span><span class="pi">:</span> <span class="s">${{ github.head_ref }}</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Format</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">mritunjaysharma394/autoyapf@v2</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">args</span><span class="pi">:</span> <span class="s">--style pep8 --recursive --in-place .</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Check for modified files</span>
        <span class="na">id</span><span class="pi">:</span> <span class="s">git-check</span>
        <span class="na">run</span><span class="pi">:</span> <span class="s">echo ::set-output name=modified::$(if git diff-index --quiet HEAD --; then echo "false"; else echo "true"; fi)</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Push changes</span>
        <span class="na">if</span><span class="pi">:</span> <span class="s">steps.git-check.outputs.modified == 'true'</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">git config --global user.name 'abc'</span>
          <span class="s">git config --global user.email 'abc123@users.noreply.github.com'</span>
          <span class="s">git remote set-url origin https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}</span>
          <span class="s">git commit -am "Apply format fixes"</span>
          <span class="s">git push</span>
</code></pre></div></div>

<p>The Format step can use Black or similar tools if you prefer.</p>

<p>Using <a href="https://github.com/rickstaa/action-black/">rickstaa/action-black</a>:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">steps</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Format</span>
    <span class="na">uses</span><span class="pi">:</span> <span class="s">rickstaa/action-black@v1</span>
    <span class="na">id</span><span class="pi">:</span> <span class="s">action_black</span>
    <span class="na">with</span><span class="pi">:</span>
      <span class="na">black_args</span><span class="pi">:</span> <span class="s2">"</span><span class="s">."</span>
</code></pre></div></div>

<p>Then use conditional step for whether to commit or not.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Commit</span>
    <span class="na">if</span><span class="pi">:</span> <span class="s">steps.action_black.outputs.is_formatted == 'true'</span>
</code></pre></div></div>

<p>You can change email and name to actions or your name or make it dynamic.</p>

        
    </div>
</article>

        </div>
    </main>
<footer class="site-footer h-card">
    <data class="u-url" href="/code-cookbook/"></data>

    <div class="wrapper">

        <h2 class="footer-heading">Code Cookbook</h2>

        <div class="footer-col-wrapper">
            <div class="footer-col footer-col-1">
                <ul class="contact-list"><li class="p-name">
                            Michael Currin
                        </li></ul>
            </div>

            <div class="footer-col footer-col-2">
<ul class="social-media-list"><li>
        <a href="https://github.com/MichaelCurrin"><svg
                class="svg-icon">
                <use xlink:href="/code-cookbook/assets/fractal-social-icons.svg#github">
                </use>
            </svg> <span class="username">MichaelCurrin</span></a>
    </li></ul>
</div>

            <div class="footer-col footer-col-3">
                <p>Reusable code patterns which you can use as reference or copy to your project</p>
            </div>
        </div>

    </div>

</footer>
<a href="https://github.com/MichaelCurrin/code-cookbook"
    class="github-corner" aria-label="View source on GitHub">
    <svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
    </svg>
</a>
<style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

</body>

</html>
